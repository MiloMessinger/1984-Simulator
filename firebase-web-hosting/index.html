<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ministry of Truth: Room Explorer</title>
    <style>
        body {
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: monospace;
            color: white;
        }
        #gameContainer {
            width: 800px;
            height: 600px;
            position: relative;
            border: 2px solid white;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            padding: 10px;
            box-sizing: border-box;
        }
        .room {
            position: relative;
            border: 4px solid white;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 20px;
        }
        .room-label {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }
        #player {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: white;
            transition: all 0.1s;
            z-index: 20;
        }
        .furniture {
            position: absolute;
            background-color: gray;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .furniture-label {
            position: absolute;
            color: white;
            font-size: 10px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .door {
            position: absolute;
            background-color: green;
            z-index: 15;
        }
        .random-object {
            position: absolute;
            background-color: red;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="victoryMansions" class="room">
            <div class="room-label">Victory Mansions</div>
        </div>
        <div id="ministryOfTruth" class="room">
            <div class="room-label">Ministry of Truth</div>
        </div>
        <div id="room101" class="room">
            <div class="room-label">Room 101</div>
        </div>
        <div id="proleDistrict" class="room">
            <div class="room-label">Prole District</div>
        </div>
        <div id="player"></div>
    </div>

    <script>
        const player = document.getElementById('player');
        const container = document.getElementById('gameContainer');
        const rooms = {
            victoryMansions: document.getElementById('victoryMansions'),
            ministryOfTruth: document.getElementById('ministryOfTruth'),
            room101: document.getElementById('room101'),
            proleDistrict: document.getElementById('proleDistrict')
        };

        // Game state
        const gameState = {
            playerX: 50,
            playerY: 50,
            currentRoom: rooms.victoryMansions,
            keys: {}
        };

        // Collision detection and movement
        function handleMovement() {
            const speed = 5;
            let newX = gameState.playerX;
            let newY = gameState.playerY;

            // Determine movement based on pressed keys
            if (gameState.keys['ArrowUp']) newY -= speed;
            if (gameState.keys['ArrowDown']) newY += speed;
            if (gameState.keys['ArrowLeft']) newX -= speed;
            if (gameState.keys['ArrowRight']) newX += speed;

            // Get room boundaries
            const roomRect = gameState.currentRoom.getBoundingClientRect();
            const playerWidth = 20;
            const playerHeight = 20;

            // Check room boundary collisions with bounce effect
            if (newX < roomRect.left - container.offsetLeft) {
                newX = roomRect.left - container.offsetLeft;
            }
            if (newX + playerWidth > roomRect.right - container.offsetLeft) {
                newX = roomRect.right - container.offsetLeft - playerWidth;
            }
            if (newY < roomRect.top - container.offsetTop) {
                newY = roomRect.top - container.offsetTop;
            }
            if (newY + playerHeight > roomRect.bottom - container.offsetTop) {
                newY = roomRect.bottom - container.offsetTop - playerHeight;
            }

            // Check furniture collisions
            const furnitureElements = gameState.currentRoom.querySelectorAll('.furniture');
            furnitureElements.forEach(furniture => {
                const furnitureRect = furniture.getBoundingClientRect();
                
                // Basic collision detection with bounce
                if (
                    newX < furnitureRect.right - container.offsetLeft &&
                    newX + playerWidth > furnitureRect.left - container.offsetLeft &&
                    newY < furnitureRect.bottom - container.offsetTop &&
                    newY + playerHeight > furnitureRect.top - container.offsetTop
                ) {
                    // Determine collision side and adjust position
                    if (gameState.playerX + playerWidth <= furnitureRect.left - container.offsetLeft) {
                        newX = furnitureRect.left - container.offsetLeft - playerWidth;
                    }
                    if (gameState.playerX >= furnitureRect.right - container.offsetLeft) {
                        newX = furnitureRect.right - container.offsetLeft;
                    }
                    if (gameState.playerY + playerHeight <= furnitureRect.top - container.offsetTop) {
                        newY = furnitureRect.top - container.offsetTop - playerHeight;
                    }
                    if (gameState.playerY >= furnitureRect.bottom - container.offsetTop) {
                        newY = furnitureRect.bottom - container.offsetTop;
                    }
                }
            });

            // Check for door crossings
            const doors = gameState.currentRoom.querySelectorAll('.door');
            doors.forEach(door => {
                const doorRect = door.getBoundingClientRect();
                if (
                    newX < doorRect.right - container.offsetLeft &&
                    newX + playerWidth > doorRect.left - container.offsetLeft &&
                    newY < doorRect.bottom - container.offsetTop &&
                    newY + playerHeight > doorRect.top - container.offsetTop
                ) {
                    // Determine which room to move to
                    if (gameState.currentRoom === rooms.victoryMansions && door.parentElement === rooms.victoryMansions) {
                        gameState.currentRoom = rooms.ministryOfTruth;
                        newX = 50;
                        newY = 50;
                    } else if (gameState.currentRoom === rooms.ministryOfTruth && door.parentElement === rooms.ministryOfTruth) {
                        gameState.currentRoom = rooms.room101;
                        newX = 50;
                        newY = 50;
                    } else if (gameState.currentRoom === rooms.room101 && door.parentElement === rooms.room101) {
                        gameState.currentRoom = rooms.proleDistrict;
                        newX = 50;
                        newY = 50;
                    }
                }
            });

            // Update player position
            gameState.playerX = newX;
            gameState.playerY = newY;
            player.style.left = `${newX}px`;
            player.style.top = `${newY}px`;
        }

        // Key event listeners
        document.addEventListener('keydown', (event) => {
            gameState.keys[event.key] = true;
        });

        document.addEventListener('keyup', (event) => {
            gameState.keys[event.key] = false;
        });

        // Game loop
        function gameLoop() {
            handleMovement();
            requestAnimationFrame(gameLoop);
        }

        // Existing room setup functions remain the same as in previous version
        function createFurniture() {
            const furnitureData = [
                { width: 100, height: 50, left: 50, top: 150, label: 'Desk' },
                { width: 120, height: 80, right: 50, top: 150, label: 'Bed' },
                { width: 200, height: 20, left: 100, top: 50, label: 'Telescreen' }
            ];

            furnitureData.forEach(data => {
                const furniture = document.createElement('div');
                furniture.classList.add('furniture');
                furniture.style.width = `${data.width}px`;
                furniture.style.height = `${data.height}px`;
                
                if (data.left !== undefined) furniture.style.left = `${data.left}px`;
                if (data.right !== undefined) furniture.style.right = `${data.right}px`;
                furniture.style.top = `${data.top}px`;
                
                const label = document.createElement('div');
                label.classList.add('furniture-label');
                label.textContent = data.label;
                furniture.appendChild(label);
                
                rooms.victoryMansions.appendChild(furniture);
            });
        }

        function createMinistryOfTruthFurniture() {
            const desk = document.createElement('div');
            desk.classList.add('furniture');
            desk.style.width = '150px';
            desk.style.height = '70px';
            desk.style.top = '100px';
            desk.style.left = '100px';
            
            const deskLabel = document.createElement('div');
            deskLabel.classList.add('furniture-label');
            deskLabel.textContent = 'Ministry Desk';
            desk.appendChild(deskLabel);
            
            rooms.ministryOfTruth.appendChild(desk);
        }

        function createProleDistrictObjects() {
            const proleRect = rooms.proleDistrict.getBoundingClientRect();
            
            for (let i = 0; i < 4; i++) {
                const object = document.createElement('div');
                object.classList.add('random-object');
                object.style.width = '20px';
                object.style.height = '20px';
                
                object.style.left = `${Math.random() * (proleRect.width - 40)}px`;
                object.style.top = `${Math.random() * (proleRect.height - 40)}px`;
                
                rooms.proleDistrict.appendChild(object);
            }
        }

        function createDoors() {
            const doorWidth = 40;
            const doorHeight = 10;

            // Door from Victory Mansions to Ministry of Truth (top right)
            const victoryToMinistry = document.createElement('div');
            victoryToMinistry.classList.add('door');
            victoryToMinistry.style.width = `${doorWidth}px`;
            victoryToMinistry.style.height = `${doorHeight}px`;
            victoryToMinistry.style.top = '0px';
            victoryToMinistry.style.right = '200px';
            rooms.victoryMansions.appendChild(victoryToMinistry);

            // Door from Ministry of Truth to Room 101 (bottom right)
            const ministryToRoom101 = document.createElement('div');
            ministryToRoom101.classList.add('door');
            ministryToRoom101.style.width = `${doorWidth}px`;
            ministryToRoom101.style.height = `${doorHeight}px`;
            ministryToRoom101.style.bottom = '0px';
            ministryToRoom101.style.right = '200px';
            rooms.ministryOfTruth.appendChild(ministryToRoom101);

            // Door from Room 101 to Prole District (bottom left)
            const room101ToProle = document.createElement('div');
            room101ToProle.classList.add('door');
            room101ToProle.style.width = `${doorWidth}px`;
            room101ToProle.style.height = `${doorHeight}px`;
            room101ToProle.style.bottom = '0px';
            room101ToProle.style.left = '200px';
            rooms.room101.appendChild(room101ToProle);
        }

        // Initialize game elements
        createFurniture();
        createMinistryOfTruthFurniture();
        createProleDistrictObjects();
        createDoors();

        // Start game loop
        gameLoop();
    </script>
</body>
</html>